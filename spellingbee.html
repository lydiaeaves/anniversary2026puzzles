<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Spelling Bee â€“ Anniversary Puzzle</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #fafafa;
    display: flex;
    justify-content: center;
    padding: 40px;
  }

  .game {
    position: relative;
    width: 360px;
    text-align: center;
    padding-top: 24px;
  }

  h1 { margin-bottom: 8px; }

  .current {
    font-size: 1.6rem;
    min-height: 36px;
    letter-spacing: 0.25em;
    margin-bottom: 10px;
  }

  .hive {
    position: relative;
    width: 240px;
    height: 220px;
    margin: 0 auto 16px;
  }

  .hex {
    position: absolute;
    width: 70px;
    height: 70px;
    cursor: pointer;
  }

  .hex svg {
    width: 100%;
    height: 100%;
  }

  .hex polygon {
    fill: #e6e6e6;
    stroke: #111;
    stroke-width: 2;
    shape-rendering: geometricPrecision;
  }

  .hex.center polygon {
    fill: #f7da21;
  }

  .hex text {
    font-size: 26px;
    font-weight: 700;
    text-anchor: middle;
    dominant-baseline: middle;
    pointer-events: none;
  }

  .controls button {
    margin: 4px;
    padding: 8px 14px;
    border-radius: 999px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
  }

  .new-game {
    position: absolute;
    top: 0;
    right: 16px;
    font-size: 0.8rem;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #ccc;
    background: #f4f4f4;
    cursor: pointer;
    opacity: 0.85;
  }

  .new-game:hover {
    opacity: 1;
  }

  .score {
    font-weight: 600;
    margin-top: 10px;
  }

  .rank {
    margin-top: 4px;
    font-size: 0.95rem;
  }

  .found {
    margin-top: 12px;
    font-size: 0.9rem;
    text-align: left;
  }

  .message {
    margin-top: 8px;
    font-weight: 600;
  }

  #hintsGrid {
    display: none;
    background: #f0f0f0;
    padding: 10px;
    border-radius: 8px;
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid #ccc;
    font-size: 0.9rem;
    margin-top: 16px;
    text-align: center;
  }

  #hintsGrid table {
    border-collapse: collapse;
    width: 100%;
  }

  #hintsGrid th, #hintsGrid td {
    border: 1px solid #999;
    padding: 4px 6px;
  }

  #hintsGrid th {
    background: #ddd;
  }
</style>
</head>

<body>
<div class="game">
  <button id="newGame" class="new-game">New Game</button>
  <button id="hints" class="new-game" style="right: 100px;">Hints</button>

  <h1>Spelling Bee</h1>

  <div class="current" id="current"></div>
  <div class="hive" id="hive"></div>

  <div class="controls">
    <button id="submit">Enter</button>
    <button id="shuffle" aria-label="Shuffle">ðŸ”€</button>
    <button id="delete">Delete</button>
  </div>

  <div class="score">
    Score: <span id="score">0</span>
  </div>
  <div class="rank" id="rank">Beginner</div>

  <div class="found" id="words"></div>
  <div class="message" id="message"></div>

  <div id="hintsGrid">
    <h3>Hint Grid</h3>
    <div id="hintsContent"></div>
  </div>
</div>

<script>
/* ======================
   CONFIG
====================== */
const REQUIRED = 'E';
let outerLetters = ['O','V','R','C','K','D'];

const VALID_WORDS = new Set([
  'CEDE','CERE','CERO','CODE','COED','COKE','CORD','CORE','CORK','COVE',
  'CRED','DECK','DECO','DEED','DEER','DEKE','DERE','DOCK','DOER','DORE',
  'DORK','DOVE','DREE','DREK','EDDO','EKED','EVER','KORE','OVER','RECK',
  'REDD','REDE','REDO','REED','REEK','ROCK','RODE','ROVE','VEER',
  'CEDED','CEDER','CERED','CODED','CODER','COKED','CORED','COVED','COVER',
  'CREDO','CREED','CREEK','DECOR','DEKED','DRECK','DREED','DROKE','DROVE',
  'ERODE','EVOKE','KEEVE','OCKER','ODDER','REDED','REEVE','ROVED','ROVER',
  'CODDER','CORDED','CORKED','CORVEE','DECKED','DECKER','DECODE','DECREE',
  'DOCKED','DOCKER','DROVED','ERODED','EVOKED','EVOKER','OVERED','RECEDE',
  'RECKED','RECODE','REEDED','REEKED','REEVED','REVOKE','ROCKED','VEERED',
  'COOKED','COOKER','RECOOK','COCKED','RECOCK',
  'COVERED','DECODER','DECREED','RECEDED','RECODED','REEVOKE','REVOKED','CROOKED'
  'RECOCKED','OVERDECK','REEVOKED',
  'OVERDECKED','OVERCOOKED','RECOOKED'
]);

/* ======================
   STATE
====================== */
let current = '';
let found = new Set();
let score = 0;

/* ======================
   ELEMENTS
====================== */
const hiveEl = document.getElementById('hive');
const currentEl = document.getElementById('current');
const scoreEl = document.getElementById('score');
const rankEl = document.getElementById('rank');
const wordsEl = document.getElementById('words');
const messageEl = document.getElementById('message');
const hintsGridEl = document.getElementById('hintsGrid');
const hintsContentEl = document.getElementById('hintsContent');

/* ======================
   STORAGE
====================== */
const STORAGE_KEY = 'spellingBeeState';

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    found: [...found],
    score
  }));
}

function loadState() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (!data) return;

  try {
    const parsed = JSON.parse(data);
    found = new Set(parsed.found || []);
    score = parsed.score || 0;
    scoreEl.textContent = score;
    renderWords();
    updateRank();
  } catch {}
}

function resetGame() {
  if (!confirm('Start a new game? This will erase progress.')) return;
  localStorage.removeItem(STORAGE_KEY);
  found.clear();
  score = 0;
  current = '';
  scoreEl.textContent = 0;
  rankEl.textContent = 'Beginner';
  wordsEl.innerHTML = '';
  messageEl.textContent = '';
  hintsGridEl.style.display = 'none';
  update();
}

/* ======================
   HINT GRID
====================== */
function generateHintGrid(words) {
  const grid = {};
  const letters = [...new Set([...words].map(w => w[0]))].sort();
  const lengths = [...new Set([...words].map(w => w.length))].sort((a,b)=>a-b);

  letters.forEach(l => grid[l] = {});
  lengths.forEach(len => letters.forEach(l => grid[l][len] = 0));

  [...words].forEach(w => {
    const first = w[0];
    const len = w.length;
    grid[first][len] += 1;
  });

  return {grid, letters, lengths};
}

function renderHintTable() {
  const {grid, letters, lengths} = generateHintGrid(VALID_WORDS);

  let html = '<table>';
  // header
  html += '<tr><th></th>';
  lengths.forEach(len => html += `<th>${len}</th>`);
  html += '<th>Î£</th></tr>';

  // rows
  letters.forEach(l => {
    let rowSum = 0;
    html += `<tr><th>${l}</th>`;
    lengths.forEach(len => {
      const val = grid[l][len] || 0;
      html += `<td>${val ? val : "-"}</td>`;
      rowSum += val;
    });
    html += `<td>${rowSum}</td></tr>`;
  });

  // column totals
  html += '<tr><th>Î£</th>';
  lengths.forEach(len => {
    let colSum = letters.reduce((s,l) => s + (grid[l][len] || 0),0);
    html += `<td>${colSum ? colSum : "-"}</td>`;
  });
  const total = letters.reduce((s,l) => s + Object.values(grid[l]).reduce((a,b)=>a+b,0),0);
  html += `<td>${total}</td></tr>`;

  html += '</table>';

  hintsContentEl.innerHTML = html;
}

document.getElementById('hints').onclick = () => {
  if (hintsGridEl.style.display === 'none') {
    renderHintTable();
    hintsGridEl.style.display = 'block';
  } else {
    hintsGridEl.style.display = 'none';
  }
};

/* ======================
   SCORE CALCS
====================== */
const maxScore = [...VALID_WORDS].reduce((sum, w) => {
  let pts = w.length;
  if (new Set(w).size === 7) pts += 7;
  return sum + pts;
}, 0);

/* ======================
   GAME LOGIC
====================== */
function submitWord() {
  const word = current;
  if (word.length < 4) return reject('Too short');
  if (!word.includes(REQUIRED)) return reject('Must include E');
  if (!VALID_WORDS.has(word)) return reject('Not in list');
  if (found.has(word)) return reject('Already found');

  found.add(word);
  let pts = word.length;
  if (new Set(word).size === 7) show('âœ¨ Pangram! âœ¨'); else show('');
  score += pts;

  scoreEl.textContent = score;
  updateRank();
  renderWords();
  saveState();

  current = '';
  update();
}

function reject(msg) {
  show(msg);
  current = '';
  update();
}

function updateRank() {
  if (found.size === VALID_WORDS.size) {
    rankEl.textContent = 'ðŸ‘‘ Queen Bee!';
    return;
  }
  const pct = score / maxScore;
  const ranks = ['Beginner','Good Start','Moving Up','Good','Solid','Nice','Great','Amazing','Genius'];
  rankEl.textContent = ranks[Math.min(ranks.length-1, Math.floor(pct*10))];
}

function renderWords() {
  wordsEl.innerHTML = [...found].sort().map(w => `<div>${w}</div>`).join('');
}

function update() {
  currentEl.textContent = current;
}

function show(msg) {
  messageEl.textContent = msg;
}

/* ======================
   CONTROLS
====================== */
document.getElementById('submit').onclick = submitWord;
document.getElementById('delete').onclick = () => {
  current = current.slice(0, -1);
  update();
};
document.getElementById('shuffle').onclick = () => {
  outerLetters.sort(() => Math.random() - 0.5);
  renderHive();
};
document.getElementById('newGame').onclick = resetGame;

/* ======================
   HEX DRAWING
====================== */
function addHex(letter, x, y, center = false) {
  const div = document.createElement('div');
  div.className = 'hex' + (center ? ' center' : '');
  div.style.left = x + 'px';
  div.style.top = y + 'px';
  div.innerHTML = `
    <svg viewBox="0 0 100 100">
      <polygon points="0,50 25,0 75,0 100,50 75,100 25,100"></polygon>
      <text x="50" y="58">${letter}</text>
    </svg>`;
  div.onclick = () => { current += letter; update(); };
  hiveEl.appendChild(div);
}

function renderHive() {
  hiveEl.innerHTML = '';
  const size = 70, h = size * 0.75, v = size * 0.5, cx = 85, cy = 70;
  addHex(REQUIRED, cx, cy, true);
  [[cx,cy-size],[cx+h,cy-v],[cx+h,cy+v],[cx,cy+size],[cx-h,cy+v],[cx-h,cy-v]]
    .forEach((p,i)=>addHex(outerLetters[i],p[0],p[1]));
}

/* ======================
   INIT
====================== */
renderHive();
loadState();
</script>
</body>
</html>
